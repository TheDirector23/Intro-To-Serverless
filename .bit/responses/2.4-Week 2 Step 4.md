---
files: index.js
stepType: PRmerge
scripts: n/a
week: 2
step: 4
name: Week 2 Step 4
---

Week 2 Step 4 ‚¨§‚¨§‚óØ‚óØ‚óØ‚óØ‚óØ | üïê Estimated completion: 5-20 minutes

### ‚úÖ Task:
**Modify your Azure Function so that it returns the dominant emotion of an image.**
- [ ] In your function `emotionalgifs`, determine the dominant emotion in the emotion data
- [ ] Output the dominant emotion when you make a `POST` request
- [ ] Commit your code to `week2/emotional.js`

## What is multipart request?
A **HTTP multipart request** is a HTTP request that HTTP clients construct to send files and data over to a HTTP Server. 

> üí° This is commonly used by browsers and HTTP clients to **upload** files to the server.

Because we want to send an image file through an HTTP Request, we need a piece of software to parse the raw data to extract the image file. Here comes the handy NPM package: `parse-multipart`! 

The raw payload formatted as multipart/form-data will looks like this one:

```
------WebKitFormBoundaryDtbT5UpPj83kllfw
Content-Disposition: form-data; name="uploads[]"; filename="somebinary.dat"
Content-Type: application/octet-stream

some binary data...maybe the bits of a image..
------WebKitFormBoundaryDtbT5UpPj83kllfw
Content-Disposition: form-data; name="uploads[]"; filename="sometext.txt"
Content-Type: text/plain

hello how are you
------WebKitFormBoundaryDtbT5UpPj83kllfw--
```

The lines above represents a **raw multipart/form-data payload** sent by some HTTP client via form submission containing two files. We need to extract the all files contained inside it. The multipart format allows you to send more than one file in the same payload, that's why it is called: multipart.

<details>
<summary>How do I use this package?</summary>
</br>

Notice that `multipart.Parse(body, boundary)`  requires two parameters.  I've already gotten the boundary for you ‚Äì just like the documentation example, our boundary is a string in the format `"----WebKitFormBoundary(random characters here)"`.

In the `multipart.Parse()` call, you need to figure out what the body parameter should be.

> :bulb: **Hint:** It should be the request body. Think about the template HTTP Trigger Azure function. How did we access the body in there?

```js

// here's your boundary:
var boundary = multipart.getBoundary(req.headers['content-type']);
  
// TODO: assign the body variable the correct value
var body = '<WHAT GOES HERE?>'

// parse the body
var parts = multipart.Parse(body, boundary);
```
</details>

## üñºÔ∏è Receiving the image
We will be making a **POST request** to the function with an image, which *will be sent in the body*.

Take a look at the standard `module.exports` function code:

```js
module.exports = async function (context, req) {
    // the code
}
```

This is the function that runs **every time your HTTP trigger gets a request**. As a parameter of this function, the `req` parameter contains all the information the request was sent with. *This contains*:
* Headers
* The body

We will be using the `req` parameter to get the image that was sent through the **body** of the POST request.

```js
let img = req.body
```
<br>
</details>

<br></br>
